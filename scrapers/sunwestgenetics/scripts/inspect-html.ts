/**
 * Inspect HTML Structure of SunWest Genetics
 * 
 * Script to fetch and inspect the HTML structure of SunWest Genetics
 * to help identify correct CSS selectors
 * 
 * referal product-card form website:
 * <li class="product type-product post-5013273 status-publish instock product_cat-autoflower product_tag-arb product_tag-new-strains product_tag-sale has-post-thumbnail taxable shipping-taxable purchasable product-type-variable">
<div class="prod-wrapper" id="prods">
<div class="products-content">
<div class="icatztop">
<ul class="elementor-icon-list-items" style="padding-bottom: 5px;"><li class="elementor-icon-list-item">
<span class="elementor-icon-list-icon">
<svg xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve"><defs></defs><g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)"> <path d="M 89.328 2.625 L 89.328 2.625 c -1.701 -2.859 -5.728 -3.151 -7.824 -0.568 L 46.532 45.173 c -0.856 1.055 -2.483 0.997 -3.262 -0.115 l -8.382 -11.97 c -2.852 -4.073 -8.789 -4.335 -11.989 -0.531 l 0 0 c -2.207 2.624 -2.374 6.403 -0.408 9.211 l 17.157 24.502 c 2.088 2.982 6.507 2.977 8.588 -0.011 l 4.925 -7.07 L 89.135 7.813 C 90.214 6.272 90.289 4.242 89.328 2.625 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(136,209,9); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round"></path> <path d="M 45 90 C 20.187 90 0 69.813 0 45 C 0 20.187 20.187 0 45 0 c 6.072 0 11.967 1.19 17.518 3.538 c 2.034 0.861 2.986 3.208 2.125 5.242 c -0.859 2.035 -3.207 2.987 -5.242 2.126 C 54.842 8.978 49.996 8 45 8 C 24.598 8 8 24.598 8 45 c 0 20.402 16.598 37 37 37 c 20.402 0 37 -16.598 37 -37 c 0 -3.248 -0.42 -6.469 -1.249 -9.573 c -0.57 -2.134 0.698 -4.327 2.832 -4.897 c 2.133 -0.571 4.326 0.698 4.896 2.833 C 89.488 37.14 90 41.055 90 45 C 90 69.813 69.813 90 45 90 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(117,117,117); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round"></path></g></svg> </span>
<span class="elementor-icon-list-text">Indica Dominant Hybrid</span>
</li></ul></div>
<div class="prod-img">
<div class="seller_all_tags"></div>                                                        <figure class="main_img pimageloop">
<a href="https://www.sunwestgenetics.com/wedding-cake-autoflower-marijuana-seeds/"> <img width="250" height="281" src="https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-250x281.jpg" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail wp-post-image perfmatters-lazy entered pmloaded" alt="Wedding Cake autoflower min 1" decoding="async" data-src="https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-250x281.jpg" data-srcset="https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-250x281.jpg 250w, https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-64x72.jpg 64w, https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-150x169.jpg 150w" data-sizes="(max-width: 250px) 100vw, 250px" data-ll-status="loaded" sizes="(max-width: 250px) 100vw, 250px" srcset="https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-250x281.jpg 250w, https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-64x72.jpg 64w, https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-150x169.jpg 150w"><noscript><img width="250" height="281" src="https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-250x281.jpg" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail wp-post-image" alt="Wedding Cake autoflower min 1" decoding="async" srcset="https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-250x281.jpg 250w, https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-64x72.jpg 64w, https://www.sunwestgenetics.com/wp-content/uploads/2020/02/Wedding-Cake-autoflower-min-1-150x169.jpg 150w" sizes="(max-width: 250px) 100vw, 250px" /></noscript></a>
</figure>
</div>
<article>
<h3 class="prod_titles"><a href="https://www.sunwestgenetics.com/wedding-cake-autoflower-marijuana-seeds/">Wedding Cake Strain Autoflower Marijuana Seeds</a></h3>
<div class="prod-meta">
<div class="container prod-reviews px-0 py-2 align-middle">
<div class="row">
<div class="col-md-5 pt-1 align-middle">
<div class="raiting-and-review-count"><div class="star-rating" role="img" aria-label="Rated 5.00 out of 5"><span style="width:100%">Rated <strong class="rating">5.00</strong> out of 5 based on <span class="rating">1</span> customer rating</span></div></div>       
</div>
<ul class="elementor-icon-list-items">
<li class="elementor-icon-list-item">
<span class="elementor-icon-list-icon">
<svg aria-hidden="true" class="e-font-icon-svg e-fas-percentage" viewBox="0 0 384 512" xmlns="https://www.w3.org/2000/svg"><path d="M109.25 173.25c24.99-24.99 24.99-65.52 0-90.51-24.99-24.99-65.52-24.99-90.51 0-24.99 24.99-24.99 65.52 0 90.51 25 25 65.52 25 90.51 0zm256 165.49c-24.99-24.99-65.52-24.99-90.51 0-24.99 24.99-24.99 65.52 0 90.51 24.99 24.99 65.52 24.99 90.51 0 25-24.99 25-65.51 0-90.51zm-1.94-231.43l-22.62-22.62c-12.5-12.5-32.76-12.5-45.25 0L20.69 359.44c-12.5 12.5-12.5 32.76 0 45.25l22.62 22.62c12.5 12.5 32.76 12.5 45.25 0l274.75-274.75c12.5-12.49 12.5-32.75 0-45.25z"></path></svg> </span>
<span class="elementor-icon-list-text"><b>THC: </b>20-25%</span>
</li>
<li class="elementor-icon-list-item">
<span class="elementor-icon-list-icon">
<svg aria-hidden="true" class="e-font-icon-svg e-fas-percentage" viewBox="0 0 384 512" xmlns="https://www.w3.org/2000/svg"><path d="M109.25 173.25c24.99-24.99 24.99-65.52 0-90.51-24.99-24.99-65.52-24.99-90.51 0-24.99 24.99-24.99 65.52 0 90.51 25 25 65.52 25 90.51 0zm256 165.49c-24.99-24.99-65.52-24.99-90.51 0-24.99 24.99-24.99 65.52 0 90.51 24.99 24.99 65.52 24.99 90.51 0 25-24.99 25-65.51 0-90.51zm-1.94-231.43l-22.62-22.62c-12.5-12.5-32.76-12.5-45.25 0L20.69 359.44c-12.5 12.5-12.5 32.76 0 45.25l22.62 22.62c12.5 12.5 32.76 12.5 45.25 0l274.75-274.75c12.5-12.49 12.5-32.75 0-45.25z"></path></svg> </span>
<span class="elementor-icon-list-text"><b>CBD: </b>1-2%</span>
</li>
<li class="elementor-icon-list-item">
<span class="elementor-icon-list-icon">
<svg xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve"><defs></defs><g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)"> <path d="M 89.328 2.625 L 89.328 2.625 c -1.701 -2.859 -5.728 -3.151 -7.824 -0.568 L 46.532 45.173 c -0.856 1.055 -2.483 0.997 -3.262 -0.115 l -8.382 -11.97 c -2.852 -4.073 -8.789 -4.335 -11.989 -0.531 l 0 0 c -2.207 2.624 -2.374 6.403 -0.408 9.211 l 17.157 24.502 c 2.088 2.982 6.507 2.977 8.588 -0.011 l 4.925 -7.07 L 89.135 7.813 C 90.214 6.272 90.289 4.242 89.328 2.625 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(111,178,6); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round"></path> <path d="M 45 90 C 20.187 90 0 69.813 0 45 C 0 20.187 20.187 0 45 0 c 6.072 0 11.967 1.19 17.518 3.538 c 2.034 0.861 2.986 3.208 2.125 5.242 c -0.859 2.035 -3.207 2.987 -5.242 2.126 C 54.842 8.978 49.996 8 45 8 C 24.598 8 8 24.598 8 45 c 0 20.402 16.598 37 37 37 c 20.402 0 37 -16.598 37 -37 c 0 -3.248 -0.42 -6.469 -1.249 -9.573 c -0.57 -2.134 0.698 -4.327 2.832 -4.897 c 2.133 -0.571 4.326 0.698 4.896 2.833 C 89.488 37.14 90 41.055 90 45 C 90 69.813 69.813 90 45 90 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(111,178,6); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round"></path></g></svg> </span>
<span class="elementor-icon-list-text"><b>Growing Level: </b>Easy</span>
</li>
<li class="elementor-icon-list-item">
<span class="elementor-icon-list-icon">
<svg xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve"><defs></defs><g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)"> <path d="M 89.328 2.625 L 89.328 2.625 c -1.701 -2.859 -5.728 -3.151 -7.824 -0.568 L 46.532 45.173 c -0.856 1.055 -2.483 0.997 -3.262 -0.115 l -8.382 -11.97 c -2.852 -4.073 -8.789 -4.335 -11.989 -0.531 l 0 0 c -2.207 2.624 -2.374 6.403 -0.408 9.211 l 17.157 24.502 c 2.088 2.982 6.507 2.977 8.588 -0.011 l 4.925 -7.07 L 89.135 7.813 C 90.214 6.272 90.289 4.242 89.328 2.625 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(111,178,6); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round"></path> <path d="M 45 90 C 20.187 90 0 69.813 0 45 C 0 20.187 20.187 0 45 0 c 6.072 0 11.967 1.19 17.518 3.538 c 2.034 0.861 2.986 3.208 2.125 5.242 c -0.859 2.035 -3.207 2.987 -5.242 2.126 C 54.842 8.978 49.996 8 45 8 C 24.598 8 8 24.598 8 45 c 0 20.402 16.598 37 37 37 c 20.402 0 37 -16.598 37 -37 c 0 -3.248 -0.42 -6.469 -1.249 -9.573 c -0.57 -2.134 0.698 -4.327 2.832 -4.897 c 2.133 -0.571 4.326 0.698 4.896 2.833 C 89.488 37.14 90 41.055 90 45 C 90 69.813 69.813 90 45 90 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(111,178,6); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round"></path></g></svg> </span>
<span class="elementor-icon-list-text"><b>Flowering: </b>8-10 weeks</span>
</li>
</ul>
</div>
</div>
<div class="pack_listed_prod packsizes">
<div class="pack_listed_prod_rght">
<div class="pack-label">Pack</div>
<div class="variation_val"><input type="radio" class="product_variation_radio" name="variation_5013273" data-pid="5013273" data-variation-id="5037942" item-price="65" value="5-seeds" aria-label="variation-5-seeds"><div class="variation_val_num">5</div></div><div class="variation_val"><input type="radio" class="product_variation_radio" name="variation_5013273" data-pid="5013273" data-variation-id="5037943" item-price="120" value="10-seeds" aria-label="variation-10-seeds"><div class="variation_val_num">10</div></div><div class="variation_val"><input type="radio" class="product_variation_radio" name="variation_5013273" data-pid="5013273" data-variation-id="5037944" item-price="240" value="25-seeds" aria-label="variation-25-seeds"><div class="variation_val_num">25</div></div>                                                            </div>
</div>
<div class="product_price_dfn">
$65.00 ‚Äì $240.00                                                        </div>
<div class="add_wrapper ">
<a rel="dofollow" href="https://www.sunwestgenetics.com/wedding-cake-autoflower-marijuana-seeds/" class="button prod_cart_addbtn">Buy Seeds Now</a> 
</div>
</div>
</article></div>
</div></li>
 * 
 * Usage:
 * npm run tsx scrapers/sunwestgenetics/scripts/inspect-html.ts
 */

import { CheerioAPI, load } from 'cheerio';
import { CATEGORY_URLS } from '../core/selectors';

async function fetchAndInspectHTML(url: string): Promise<void> {
    console.log(`\nüîç Inspecting: ${url}`);

    try {
        const response = await fetch(url);
        
        if (!response.ok) {
            console.log(`‚ùå Failed to fetch: ${response.status} ${response.statusText}`);
            return;
        }

        const html = await response.text();
        const $ = load(html);

        console.log('\nüìã Basic Page Info:');
        console.log(`Title: ${$('title').text().trim()}`);
        console.log(`Meta description: ${$('meta[name="description"]').attr('content') || 'N/A'}`);
        console.log(`HTML length: ${html.length} characters`);

        // Look for common product container patterns
        console.log('\nüîç Looking for product containers:');
        const productSelectors = [
            '.product', 
            '.product-item', 
            '.product-card',
            '.wc-block-grid__product',
            'li.product',
            '[data-product-id]',
            '.shop-item',
            '.product-wrapper',
        ];

        for (const selector of productSelectors) {
            const count = $(selector).length;
            if (count > 0) {
                console.log(`‚úÖ ${selector}: ${count} elements found`);
                
                // Show first element HTML (truncated)
                const firstElement = $(selector).first();
                if (firstElement.length > 0) {
                    const html = firstElement.html() || '';
                    console.log(`   First element HTML preview: ${html.substring(0, 200)}...`);
                }
            }
        }

        // Look for pagination
        console.log('\nüìÑ Looking for pagination:');
        const paginationSelectors = [
            '.pagination',
            '.page-numbers',
            '.woocommerce-pagination',
            '.next',
            '.prev',
            '[aria-label*="pagination"]',
            'a[href*="page"]',
            'a[href*="?page"]',
        ];

        for (const selector of paginationSelectors) {
            const count = $(selector).length;
            if (count > 0) {
                console.log(`‚úÖ ${selector}: ${count} elements found`);
                
                // Show pagination links
                $(selector).each((index, element) => {
                    if (index < 3) { // Show first 3
                        const text = $(element).text().trim();
                        const href = $(element).attr('href');
                        console.log(`   ${index + 1}. "${text}" -> ${href}`);
                    }
                });
            }
        }

        // Look for price patterns
        console.log('\nüí∞ Looking for price patterns:');
        const priceSelectors = [
            '.price',
            '.woocommerce-Price-amount',
            '.product-price',
            '[class*="price"]',
            '[data-price]',
        ];

        for (const selector of priceSelectors) {
            const count = $(selector).length;
            if (count > 0) {
                console.log(`‚úÖ ${selector}: ${count} elements found`);
                
                // Show price examples
                $(selector).each((index, element) => {
                    if (index < 3) { // Show first 3
                        const text = $(element).text().trim();
                        console.log(`   ${index + 1}. "${text}"`);
                    }
                });
            }
        }

        // Check if it's a WooCommerce site
        console.log('\nüõí WooCommerce Detection:');
        if ($('body').hasClass('woocommerce') || $('.woocommerce').length > 0) {
            console.log('‚úÖ WooCommerce detected');
        } else {
            console.log('‚ùå WooCommerce not detected');
        }

        // Check for common ecommerce platforms
        console.log('\nüè™ Platform Detection:');
        if ($('[data-shopify]').length > 0 || html.includes('Shopify')) {
            console.log('‚úÖ Shopify detected');
        } else if (html.includes('woocommerce') || $('.woocommerce').length > 0) {
            console.log('‚úÖ WooCommerce detected');
        } else if (html.includes('magento') || $('[data-magento]').length > 0) {
            console.log('‚úÖ Magento detected');
        } else {
            console.log('‚ùì Platform not clearly detected');
        }

    } catch (error) {
        console.error(`‚ùå Error inspecting ${url}:`, error);
    }
}

async function main() {
    console.log('üïµÔ∏è SunWest Genetics HTML Inspector');
    console.log('This tool helps identify the correct CSS selectors for scraping');

    // Inspect main categories
    const urlsToInspect = [
        CATEGORY_URLS.allProducts,
        CATEGORY_URLS.seeds,
        CATEGORY_URLS.feminized,
    ];

    for (const url of urlsToInspect) {
        await fetchAndInspectHTML(url);
    }

    console.log('\n‚ú® Inspection completed!');
    console.log('\nüí° Tips:');
    console.log('1. Look for selectors with high element counts');
    console.log('2. Update selectors.ts based on findings');
    console.log('3. Run test-product-list-scraper.ts to verify');
}

// Run the inspector
main().catch(console.error);