/**
 * Inspect Vancouver Seed Bank HTML Structure
 * 
 * Analyzes the product card HTML structure from vancouverseedbank.ca
 * Based on the provided HTML sample
 * 
 * Usage:
 *   pnpm tsx scrapers/vancouverseedbank/scripts/inspect-html.ts
 */

/**
 * /**
 * <li class="product type-product post-357243 status-publish last instock product_cat-feminized-seeds product_cat-new-strain product_tag-latest product_tag-new-strains has-post-thumbnail taxable shipping-taxable purchasable product-type-variable">
<div class="prod-wrapper">
<div class="products-content">
<div class="prod-img">
<div class="itype">
<ul class="elementor-icon-list-items">
<li class="elementor-icon-list-item">
<span class="elementor-icon-list-icon">
<svg aria-hidden="true" class="e-font-icon-svg e-fas-check-circle" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"></path></svg> </span>
<span class="elementor-icon-list-text">Balanced Hybrid</span>
</li>
</ul>
</div>
<div class="bogo_wrapper"><ul><li class="pack5" style="background: #E60000 !important;">New Strain 2025</li></ul></div>                                                        <figure class="main_img">
<a href="https://vancouverseedbank.ca/product/41-cherries-strain-feminized-marijuana-seeds/"> <img width="687" height="1000" src="https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries.jpg" class="attachment-medium_large size-medium_large wp-post-image perfmatters-lazy entered pmloaded" alt="41 Cherries Strain Feminized" decoding="async" data-src="https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries.jpg" data-srcset="https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries.jpg 687w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-300x437.jpg 300w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-150x218.jpg 150w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-280x408.jpg 280w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-412x600.jpg 412w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-64x93.jpg 64w" data-sizes="(max-width: 687px) 100vw, 687px" data-ll-status="loaded" sizes="(max-width: 687px) 100vw, 687px" srcset="https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries.jpg 687w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-300x437.jpg 300w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-150x218.jpg 150w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-280x408.jpg 280w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-412x600.jpg 412w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-64x93.jpg 64w"><noscript><img width="687" height="1000" src="https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries.jpg" class="attachment-medium_large size-medium_large wp-post-image" alt="41 Cherries Strain Feminized" decoding="async" srcset="https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries.jpg 687w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-300x437.jpg 300w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-150x218.jpg 150w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-280x408.jpg 280w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-412x600.jpg 412w, https://vancouverseedbank.ca/wp-content/uploads/2024/08/41-cherries-64x93.jpg 64w" sizes="(max-width: 687px) 100vw, 687px" /></noscript></a>
</figure>
</div>
<article>
<h3 class="prod_titles"><a href="https://vancouverseedbank.ca/product/41-cherries-strain-feminized-marijuana-seeds/">41 Cherries Strain Feminized Marijuana Seeds</a></h3>
<div class="prod-meta">
<div class="container prod-reviews px-0 py-2 align-middle">
<div class="row">
<div class="col-md-5">
<div class="raiting-and-review-count" style="display:flex;align-items:center;justify-content:center;"><div class="star-rating" role="img" aria-label="Rated 5.00 out of 5"><span style="width:100%">Rated <strong class="rating">5.00</strong> out of 5 based on <span class="rating">5</span> customer ratings</span></div> <div style="color:#666 !important;font-size:14px;">(5)</div></div>
</div>
<div class="col-md-7 text-right">
<div class="thc-lvl" style="font-size:15px;">THC 20-23%</div>
</div>
</div>
</div>
</div>
<div class="custom-acf-prod">
<ul class="elementor-icon-list-items">
<li class="elementor-icon-list-item">
<span class="elementor-icon-list-icon">
<svg aria-hidden="true" class="e-font-icon-svg e-fas-check-circle" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"></path></svg> </span>
<span class="elementor-icon-list-text"><span>CBD : </span>0.26%</span>
</li>
<li class="elementor-icon-list-item">
<span class="elementor-icon-list-icon">
<svg aria-hidden="true" class="e-font-icon-svg e-fas-check-circle" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"></path></svg> </span>
<span class="elementor-icon-list-text"><span>Growing Level :</span> </span>
</li>
<li class="elementor-icon-list-item">
<span class="elementor-icon-list-icon">
<svg aria-hidden="true" class="e-font-icon-svg e-fas-check-circle" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"></path></svg> </span>
<span class="elementor-icon-list-text"><span>Flowering :</span> 8-9 weeks</span>
</li>
</ul>
</div>
<div class="pack_listed_prod">
<div class="pack_listed_prod_rght">
<div class="variation_val"><input type="radio" class="product_variation_radio" name="variation_357243" data-pid="357243" data-variation-id="357245" item-price="65" value="5-seeds" aria-label="variation-5-seeds"><div class="variation_val_num">5 Seeds</div></div><div class="variation_val"><input type="radio" class="product_variation_radio" name="variation_357243" data-pid="357243" data-variation-id="357246" item-price="120" value="10-seeds" aria-label="variation-10-seeds"><div class="variation_val_num">10 Seeds</div></div><div class="variation_val"><input type="radio" class="product_variation_radio" name="variation_357243" data-pid="357243" data-variation-id="357247" item-price="240" value="25-seeds" aria-label="variation-25-seeds"><div class="variation_val_num">25 Seeds</div></div>                                                            </div>
</div>
<div class="product_price_dfn">
<span class="woocommerce-Price-amount amount"><bdi><span class="woocommerce-Price-currencySymbol">$</span>65.00</bdi></span> ‚Äì <span class="woocommerce-Price-amount amount"><bdi><span class="woocommerce-Price-currencySymbol">$</span>240.00</bdi></span>                                                        </div>
<div class="add_wrapper ">
<a rel="dofollow" href="https://vancouverseedbank.ca/product/41-cherries-strain-feminized-marijuana-seeds/" class="button prod_cart_addbtn">Buy Seeds Now</a>
</div>
</article></div>
</div>
</li>
 *
 */
// Here is html structure of product Card, let write inspection code to test necessary fields.


import { CheerioCrawler } from 'crawlee';

async function main() {
    console.log('üîç Vancouver Seed Bank - HTML Inspector');
    console.log('='.repeat(60));

    const crawler = new CheerioCrawler({
        async requestHandler({ $, request, log }) {
            log.info(`Inspecting: ${request.url}`);

            // Try different product card selectors based on HTML sample
            const selectors = [
                'li.product',
                'li.type-product',
                '.product',
                'li.product.type-product',
                'ul.products li',
            ];

            console.log('\nüîç Testing Product Card Selectors:');
            for (const selector of selectors) {
                const count = $(selector).length;
                console.log(`  ${selector}: ${count} items`);
            }

            // Find the best selector (one with products)
            let bestSelector = '';
            let maxCount = 0;
            for (const selector of selectors) {
                const count = $(selector).length;
                if (count > maxCount) {
                    maxCount = count;
                    bestSelector = selector;
                }
            }

            if (maxCount === 0) {
                console.log('\n‚ùå No product cards found with standard selectors');
                console.log('Trying to find products in page HTML...');

                // Look for common WooCommerce patterns
                const wooProducts = $('.woocommerce ul.products li').length;
                if (wooProducts > 0) {
                    console.log(`Found ${wooProducts} WooCommerce products`);
                    bestSelector = '.woocommerce ul.products li';
                    maxCount = wooProducts;
                }
            }

            if (maxCount === 0) {
                console.log('\n‚ùå No products found. Page might be JavaScript-rendered.');
                return;
            }

            console.log(`\n‚úÖ Best selector: ${bestSelector} (${maxCount} products)`);

            // Analyze first product based on HTML sample
            const $firstProduct = $(bestSelector).first();
            console.log('\nüì¶ First Product Card Analysis:');
            console.log('='.repeat(60));

            // Product Name (from HTML: h3.prod_titles a)
            console.log('\nüè∑Ô∏è  Product Name:');
            const nameSelectors = [
                'h3.prod_titles a',
                'h3.prod_titles',
                '.prod_titles a',
                'article h3 a',
                'h3 a',
            ];
            for (const sel of nameSelectors) {
                const text = $firstProduct.find(sel).first().text().trim();
                if (text) {
                    console.log(`  ‚úÖ ${sel}: "${text}"`);
                }
            }

            // Product URL (from HTML: h3.prod_titles a href)
            console.log('\nüîó Product URL:');
            const linkSelectors = [
                'h3.prod_titles a',
                '.prod_titles a',
                'a[href*="/product/"]',
                'figure.main_img a',
                'article a',
            ];
            for (const sel of linkSelectors) {
                const href = $firstProduct.find(sel).first().attr('href');
                if (href) {
                    console.log(`  ‚úÖ ${sel}: "${href}"`);
                }
            }

            // Product Image (from HTML: figure.main_img img)
            // Note: Images use lazy loading - prioritize data-src over src
            console.log('\nüñºÔ∏è  Product Image:');
            const imageSelectors = [
                'figure.main_img img',
                '.main_img img',
                '.prod-img img',
                'img.wp-post-image',
            ];
            for (const sel of imageSelectors) {
                const $img = $firstProduct.find(sel).first();
                // Prioritize data-src (lazy loading) over src (placeholder)
                const src = $img.attr('data-src') ||
                    $img.attr('data-lazy-src') ||
                    $img.attr('src');
                if (src && !src.startsWith('data:image/svg')) {
                    console.log(`  ‚úÖ ${sel}: "${src}"`);
                } else if (src) {
                    console.log(`  ‚ö†Ô∏è  ${sel}: "${src}" (placeholder/SVG)`);
                }
            }            // Cannabis Type / Strain (from HTML: .itype .elementor-icon-list-text)
            console.log('\nüåø Cannabis Type / Strain:');
            const strainSelectors = [
                '.itype .elementor-icon-list-text',
                '.itype li span.elementor-icon-list-text',
                '.prod-wrapper .itype',
            ];
            for (const sel of strainSelectors) {
                const text = $firstProduct.find(sel).first().text().trim();
                if (text) {
                    console.log(`  ‚úÖ ${sel}: "${text}"`);
                }
            }

            // Badge / Tag (from HTML: .bogo_wrapper li)
            console.log('\nüè∑Ô∏è  Badge / Tag:');
            const badgeSelectors = [
                '.bogo_wrapper li',
                '.bogo_wrapper ul li',
                '.bogo_wrapper',
            ];
            for (const sel of badgeSelectors) {
                const text = $firstProduct.find(sel).first().text().trim();
                if (text) {
                    console.log(`  ‚úÖ ${sel}: "${text}"`);
                }
            }

            // Rating (from HTML: .star-rating)
            console.log('\n‚≠ê Rating:');
            const ratingSelectors = [
                '.star-rating strong.rating',
                '.star-rating',
                '.raiting-and-review-count .star-rating',
            ];
            for (const sel of ratingSelectors) {
                const rating = $firstProduct.find(sel).first().text().trim();
                if (rating) {
                    console.log(`  ‚úÖ ${sel}: "${rating}"`);
                }

                // Also check aria-label for rating
                const ariaLabel = $firstProduct.find('.star-rating').attr('aria-label');
                if (ariaLabel) {
                    console.log(`  ‚úÖ aria-label: "${ariaLabel}"`);
                }
            }

            // Review Count (from HTML: div after star-rating)
            console.log('\nüí¨ Review Count:');
            const reviewSelectors = [
                '.raiting-and-review-count div:last-child',
                '.star-rating + div',
            ];
            for (const sel of reviewSelectors) {
                const count = $firstProduct.find(sel).first().text().trim();
                if (count) {
                    console.log(`  ‚úÖ ${sel}: "${count}"`);
                }
            }

            // THC Level (from HTML: .thc-lvl)
            console.log('\nüß™ THC Level:');
            const thcSelectors = [
                '.thc-lvl',
                '.prod-meta .thc-lvl',
                'div[class*="thc"]',
            ];
            for (const sel of thcSelectors) {
                const thc = $firstProduct.find(sel).first().text().trim();
                if (thc) {
                    console.log(`  ‚úÖ ${sel}: "${thc}"`);
                }
            }

            // CBD Level (from HTML: .custom-acf-prod li containing "CBD")
            console.log('\nüß™ CBD Level:');
            const cbdSelectors = [
                '.custom-acf-prod li:contains("CBD")',
                '.elementor-icon-list-text:contains("CBD")',
            ];
            for (const sel of cbdSelectors) {
                const cbd = $firstProduct.find(sel).first().text().trim();
                if (cbd) {
                    console.log(`  ‚úÖ ${sel}: "${cbd}"`);
                }
            }

            // Flowering Time (from HTML: .custom-acf-prod li containing "Flowering")
            console.log('\n‚è±Ô∏è  Flowering Time:');
            const floweringSelectors = [
                '.custom-acf-prod li:contains("Flowering")',
                '.elementor-icon-list-text:contains("Flowering")',
            ];
            for (const sel of floweringSelectors) {
                const flowering = $firstProduct.find(sel).first().text().trim();
                if (flowering) {
                    console.log(`  ‚úÖ ${sel}: "${flowering}"`);
                }
            }

            // Full product card HTML for reference
            console.log('\nüìã Full Product Card HTML (first 1000 chars):');
            console.log('='.repeat(60));
            const fullHtml = $firstProduct.html();
            if (fullHtml) {
                console.log(fullHtml.substring(0, 1000));
                console.log('...');
            }

            console.log('\n='.repeat(60));
            console.log('‚úÖ Inspection Complete!');
        },
    });

    // Test URLs - including pagination
    const testPages = parseInt(process.argv[2] || '1');
    const urls: string[] = [];

    if (testPages === 1) {
        // Single page test
        urls.push('https://vancouverseedbank.ca/product-category/feminized-seeds/');
    } else {
        // Multi-page test with pagination
        for (let page = 1; page <= testPages; page++) {
            if (page === 1) {
                urls.push('https://vancouverseedbank.ca/shop/jsf/epro-archive-products/');
            } else {
                urls.push(`https://vancouverseedbank.ca/shop/jsf/epro-archive-products/pagenum/${page}/`);
            }
        }
    }

    console.log(`\nüìÑ Testing ${testPages} page(s):`);
    urls.forEach((url, i) => console.log(`  Page ${i + 1}: ${url}`));
    console.log('');

    await crawler.run(urls);
}

main().catch(console.error);
